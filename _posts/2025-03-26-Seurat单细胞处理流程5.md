---
layout: post
title: "Seuratå•ç»†èƒå¤„ç†æµç¨‹ä¹‹äº”ï¼šGSVAå¯Œé›†åˆ†æ"
date: 2025-03-26
categories: Seurat
tags: [å¿ƒå¾—, å­¦ä¹ , Seurat,å•ç»†èƒæµç¨‹]
toc:  true
---

```R
rm(list = ls())
setwd("/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/irGSVA/")

##ç¦æ­¢è½¬åŒ–ä¸ºå› å­
options(stringsAsFactors = FALSE)

## è®¾ç½®ä¿å­˜çš„ç›®å½•
## æ•°æ®ç›®å½•
data_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/irGSVA/data"
if (!dir.exists(data_dir)) {
  dir.create(data_dir, recursive = TRUE)
}
## å›¾ç‰‡ç›®å½•
img_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/irGSVA/img"

if (!dir.exists(img_dir)) {
  dir.create(img_dir, recursive = TRUE)
}

```


```R
library(Seurat)
library(SeuratData)
library(RcppML)
library(readr)
library(irGSEA)
library(ggsci)
library(doMC)
library(ggunchull)
```

    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šSeuratObject
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šsp
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜SeuratObjectâ€™
    
    
    The following objects are masked from â€˜package:baseâ€™:
    
        intersect, t
    
    
    Using cached data manifest, last updated at 2025-03-11 16:14:29.676313
    
    â”€â”€ [1mInstalled datasets[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SeuratData v0.2.2.9001 â”€â”€
    
    [32mâœ”[39m [34mpbmc3k[39m 3.1.4                          
    
    
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    [32mâœ”[39m Dataset loaded successfully
    [33mâ¯[39m Dataset built with a newer version of Seurat than installed
    [31mâ“[39m Unknown version of Seurat installed
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šforeach
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šiterators
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šparallel
    



```R
## ä»£ç†ä¿¡æ¯
Sys.setenv("http_proxy"="http://10.16.46.126:7890")
Sys.setenv("https_proxy"="http://10.16.46.126:7890") 
```


```R
## è¯»å–pbmcæ–‡ä»¶
pbmc <- readRDS(file = "../é™ç»´æ³¨é‡Š/data/pbmcæ³¨é‡Šå.rds")
```


```R
## æ‰§è¡Œgsvaåˆ†æ
#### Seurat V5å¯¹è±¡ ####
## HALLMARKEåŸºå› é›†
ssc_dataset1 <- irGSEA.score(object = pbmc, assay = "RNA",
                             slot = "data", seeds = 123, 
                             ncores = 8,
                             min.cells = 3, min.feature = 0,
                             custom = F, geneset = NULL, msigdb = T,
                             species = "Homo sapiens", 
                             category = "H",  
                             subcategory = NULL, 
                             geneid = "symbol",
                             method = c("AUCell","UCell","singscore",
                                        "ssgsea", "JASMINE", "viper"),
                             aucell.MaxRank = NULL, 
                             ucell.MaxRank = NULL,
                             kcdf = 'Gaussian')

```

    Validating object structure
    
    Updating object slots
    
    Ensuring keys are in the proper structure
    
    Updating matrix keys for DimReduc â€˜pcaâ€™
    
    Updating matrix keys for DimReduc â€˜umapâ€™
    
    Ensuring keys are in the proper structure
    
    Ensuring feature names don't have underscores or pipes
    
    Updating slots in RNA
    
    Updating slots in RNA_nn
    
    Setting default assay of RNA_nn to RNA
    
    Updating slots in RNA_snn
    
    Setting default assay of RNA_snn to RNA
    
    Updating slots in pca
    
    Updating slots in umap
    
    Setting umap DimReduc to global
    
    Setting assay used for NormalizeData.RNA to RNA
    
    Setting assay used for FindVariableFeatures.RNA to RNA
    
    Setting assay used for ScaleData.RNA to RNA
    
    Setting assay used for RunPCA.RNA to RNA
    
    Setting assay used for FindNeighbors.RNA.pca to RNA
    
    No assay information could be found for FindClusters
    
    Setting assay used for RunUMAP.RNA.pca to RNA
    
    Validating object structure for Assay5 â€˜RNAâ€™
    
    Validating object structure for Graph â€˜RNA_nnâ€™
    
    Validating object structure for Graph â€˜RNA_snnâ€™
    
    Validating object structure for DimReduc â€˜pcaâ€™
    
    Validating object structure for DimReduc â€˜umapâ€™
    
    Object representation is consistent with the most current Seurat version
    
    Calculate AUCell scores
    
    Finish calculate AUCell scores
    
    Calculate UCell scores
    
    Finish calculate UCell scores
    
    Calculate singscore scores
    
    Finish calculate singscore scores
    
    Calculate ssgsea scores
    
    [36mâ„¹[39m GSVA version 2.0.4
    
    [33m![39m 1 genes with constant values throughout the samples
    
    [33m![39m 7 genes with constant non-zero values throughout the samples
    
    [36mâ„¹[39m Using a MulticoreParam parallel back-end with 8 workers
    
    [36mâ„¹[39m Calculating  ssGSEA scores for 50 gene sets
    
    [36mâ„¹[39m Calculating ranks
    
    [36mâ„¹[39m Calculating rank weights
    
    [32mâœ”[39m Calculations finished
    
    Finish calculate ssgsea scores
    
    Calculate JASMINE scores
    
    Finish calculate jasmine scores
    
    Calculate viper scores
    
    Finish calculate viper scores
    



```R
# æ•´åˆå·®å¼‚åŸºå› é›†
# å¦‚æœæŠ¥é”™ï¼Œè€ƒè™‘åŠ å¥ä»£ç options(future.globals.maxSize = 100000 * 1024^5)
result.dge1 <- irGSEA.integrate(object = ssc_dataset1,
                               group.by = "celltype",method = c("AUCell","UCell","singscore",
                                          "ssgsea", "JASMINE", "viper"))
```

    Calculate differential gene set : AUCell
    
    Finish!
    
    Calculate differential gene set : UCell
    
    Finish!
    
    Calculate differential gene set : singscore
    
    Finish!
    
    Calculate differential gene set : ssgsea
    
    Finish!
    
    Calculate differential gene set : JASMINE
    
    Finish!
    
    Calculate differential gene set : viper
    
    Finish!
    



```R

# æŸ¥çœ‹RRAè¯†åˆ«çš„åœ¨å¤šç§æ‰“åˆ†æ–¹æ³•ä¸­éƒ½æ™®éè®¤å¯çš„å·®å¼‚åŸºå› é›†
geneset.show1 <- result.dge1$RRA %>%
  dplyr::filter(pvalue <= 0.05) %>%
  dplyr::pull(Name) %>% unique(.)

```


```R
## æ°”æ³¡å›¾
bubble.plot1 <- irGSEA.bubble(object = result.dge1,
                             method = "RRA",
                             top = 20,
                             show.geneset = NULL,
                             cluster.color = pal_npg()(10),
                             direction.color = c('#90C0DC','#CF4F45'),
                             cluster_rows = F)


bubble.plot1
```


    

![IR_7_0.png](https://cdn.jsdelivr.net/gh/capablezzm/capablezzm.github.io@main/images/2025/3/1743039985665.png)
    



```R
## GO çš„å¯Œé›†ç±»ä¼¼ï¼Œå—è¿è¡Œæ—¶é—´æ‰€é™ï¼Œæ­¤å¤„ä¸å†å±•ç¤º
pbmc3k.final <- irGSEA.score(object = pbmc,assay = "RNA", 
                             slot = "data", seeds = 123, ncores = 8,
                             min.cells = 3, min.feature = 0,
                             custom = F, geneset = NULL, msigdb = T, 
                             species = "Homo sapiens", category = "C5",  
                             subcategory = "GO:BP", geneid = "symbol",
                             method = c("AUCell","UCell","singscore","ssgsea", "JASMINE"),
                             aucell.MaxRank = NULL, ucell.MaxRank = NULL, 
                             kcdf = 'Gaussian')
```


```R

```
