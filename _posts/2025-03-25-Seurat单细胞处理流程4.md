---
layout: post
title: "Seuratå•ç»†èƒå¤„ç†æµç¨‹ä¹‹å››ï¼šå·®å¼‚åˆ†æ&å¯Œé›†åˆ†æ"
date: 2025-03-25
categories: Seurat
tags: [å¿ƒå¾—, å­¦ä¹ , Seurat,å•ç»†èƒæµç¨‹]
toc:  true
---

# ç®€ä»‹
æ•´ä½“æ¥è¯´ï¼Œå•ç»†èƒçš„å·®å¼‚åˆ†æä¸æ™®é€šè½¬å½•ç»„çš„å·®å¼‚åˆ†ææµç¨‹ç±»ä¼¼ï¼Œä½†æ˜¯åŸç†ç•¥æœ‰ä¸åŒã€‚
ï¼ˆè¡¥å……å‡ ä¸ªå¸¸ç”¨åŒ…çš„åŸç†å’Œç§©å’Œæ£€éªŒçš„åŸç†ï¼‰

# 1.å·®å¼‚åˆ†æ

```R
rm(list = ls())
setwd("/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/")

##ç¦æ­¢è½¬åŒ–ä¸ºå› å­
options(stringsAsFactors = FALSE)

## è®¾ç½®ä¿å­˜çš„ç›®å½•
## æ•°æ®ç›®å½•
data_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/data"
if (!dir.exists(data_dir)) {
  dir.create(data_dir, recursive = TRUE)
}
## å›¾ç‰‡ç›®å½•
img_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/img"

if (!dir.exists(img_dir)) {
  dir.create(img_dir, recursive = TRUE)
}
```


```R
library(readr)
library(gplots)
library(ggplot2)
library(Seurat)
library(scRNAtoolVis)
library(dplyr)
```

    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼štidyverse
    
    â”€â”€ [1mAttaching core tidyverse packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
    [32mâœ”[39m [34mforcats  [39m 1.0.0     [32mâœ”[39m [34mstringr  [39m 1.5.1
    [32mâœ”[39m [34mlubridate[39m 1.9.4     [32mâœ”[39m [34mtibble   [39m 3.2.1
    [32mâœ”[39m [34mpurrr    [39m 1.0.2     [32mâœ”[39m [34mtidyr    [39m 1.3.1
    â”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
    [31mâœ–[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
    [31mâœ–[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
    [36mâ„¹[39m Use the conflicted package ([3m[34m<http://conflicted.r-lib.org/>[39m[23m) to force all conflicts to become errors



```R
## è¯»å–æ³¨é‡Šä¹‹åçš„æ–‡ä»¶
pbmc <- read_rds(file = "./data/cd8æ³¨é‡Šå.rds")

## åˆ é™¤æ‰€æœ‰çš„çº¿ç²’ä½“åŸºå› å’Œæ ¸ç³–ä½“åŸºå› åå†è¿›è¡Œå·®å¼‚åˆ†æ
exp_m <- GetAssayData(pbmc, layer = 'counts')
gene.all <- rownames(exp_m)
mt.gene  = grep('^MT-', gene.all, value = TRUE)#çº¿ç²’ä½“åŸºå› 
ribosome.gene = grep('^RPL|^RPS|^MRPS|^MRPL', gene.all, value = TRUE)#æ ¸ç³–ä½“åŸºå› 
features = setdiff(gene.all, c(mt.gene, ribosome.gene))#å»é™¤ä¸éœ€è¦çš„åŸºå› 

```


```R
unique(pbmc$group)
```


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Resistant'</li><li>'Pre'</li><li>'Sensitive'</li></ol>




```R
# å·®å¼‚è¡¨è¾¾åˆ†æå‡½æ•°
perform_deg_analysis <- function(cell_subset, ident1, ident2) {
  FindMarkers(
    object = cell_subset,
    logfc.threshold = 0.25,
    min.pct = 0.1,
    only.pos = FALSE,
    features = features,
    ident.1 = ident1,
    ident.2 = ident2
  ) %>% mutate(gene = rownames(.))
}

## é˜ˆå€¼å¯ä»¥ä¿®æ”¹
```


```R
# ç­›é€‰å‡½æ•°
filter_degs <- function(deg_data) {
  deg_data %>%
    filter(pct.1 > 0.1 & p_val < 0.05) %>%
    filter(abs(avg_log2FC) > 0.5)
}
```


```R
## æå–texâ€”cd8
tex_cd8 <- subset(pbmc, subset = celltype == "Tex_CD8")
```


```R
## æ‰§è¡Œå·®å¼‚åˆ†æ
Idents(tex_cd8)="group"
tex_cd8_degs <- perform_deg_analysis(tex_cd8, "Resistant", "Sensitive")
tex_cd8_degs_fil <- filter_degs(tex_cd8_degs)
```


```R
## ä¿å­˜exçš„å·®å¼‚åŸºå› 
write.csv(tex_cd8_degs_fil,file = "./data/tex_cd8_å·®å¼‚åŸºå› .csv")
```


```R
# å…¨éƒ¨ç»†èƒçš„å·®å¼‚åˆ†æ ---------------------------------------------------------------
Idents(pbmc) <- pbmc$group
# å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æ¯ä¸ªç»†èƒç±»å‹
process_cell_type <- function(cell_type, pbmc) {
  # å­é›†åŒ–ä¸ºç‰¹å®šç»†èƒç±»å‹
  cell_subset <- subset(pbmc, subset = celltype == cell_type)
  
  # æŸ¥æ‰¾å·®å¼‚è¡¨è¾¾åŸºå› 
  degs <- FindMarkers(cell_subset, 
                      logfc.threshold = 0.25,
                      min.pct = 0.1, 
                      only.pos = FALSE, 
                      features = features,
                      ident.1 = "Resistant", ident.2 = "Sensitive") %>%
    mutate(gene = rownames(.))
  
  # è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„å·®å¼‚è¡¨è¾¾åŸºå› 
  degs_filtered <- degs %>%
    filter(pct.1 > 0.1 & p_val_adj < 0.05) %>%
    filter(abs(avg_log2FC) > 0.5)
  
  # è¿”å›è¿‡æ»¤åçš„ç»“æœï¼Œå¹¶æ ‡è®°æ˜¯å“ªä¸ªç»†èƒç±»å‹
  return(list(cell_type = cell_type, degs_filtered = degs_filtered))
}

```


```R
# è·å–æ‰€æœ‰ç‹¬ç‰¹çš„ç»†èƒç±»å‹
cell_types <- unique(pbmc$celltype)
cell_types

# ä½¿ç”¨ lapply å¯¹æ¯ä¸ªç»†èƒç±»å‹è¿›è¡Œå¤„ç†
results <- lapply(cell_types, function(cell_type) process_cell_type(cell_type, pbmc))
```


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Trm_CD8'</li><li>'Cytotox_CD8'</li><li>'Naive_CD8'</li><li>'Tem_CD8'</li><li>'Tex_CD8'</li></ol>




```R
# å°†ç»“æœç»„åˆæˆä¸€ä¸ªæ•°æ®æ¡†
library(dplyr)

# ç»„åˆæ‰€æœ‰ç»†èƒç±»å‹çš„å·®å¼‚è¡¨è¾¾åŸºå› æ•°æ®
combined_results <- do.call(rbind, lapply(results, function(x) {
  x$degs_filtered %>% mutate(cell_type = x$cell_type)
}))

# å°†æœ€åä¸€åˆ—æ”¹æˆcluster
colnames(combined_results)[colnames(combined_results) == "cell_type"] <- "cluster"

combined_results$cluster <- as.factor(combined_results$cluster)
## ä¿å­˜å·®å¼‚ç»“æœ
head(combined_results)
table(combined_results$cluster)
write.csv(combined_results,file = "./data/cd8å·®å¼‚ç»“æœ.csv")
combined_results <- read.csv(file = "./data/cd8å·®å¼‚ç»“æœ.csv")
```


<table class="dataframe">
<caption>A data.frame: 6 Ã— 7</caption>
<thead>
	<tr><th></th><th scope=col>p_val</th><th scope=col>avg_log2FC</th><th scope=col>pct.1</th><th scope=col>pct.2</th><th scope=col>p_val_adj</th><th scope=col>gene</th><th scope=col>cluster</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>HLA-B</th><td>1.884343e-244</td><td>0.6819049</td><td>0.999</td><td>0.976</td><td>3.729116e-240</td><td>HLA-B  </td><td>Trm_CD8</td></tr>
	<tr><th scope=row>PCBP2</th><td>5.772154e-190</td><td>1.1862094</td><td>0.736</td><td>0.454</td><td>1.142309e-185</td><td>PCBP2  </td><td>Trm_CD8</td></tr>
	<tr><th scope=row>ZFP36</th><td>4.087883e-127</td><td>0.7755835</td><td>0.912</td><td>0.764</td><td>8.089920e-123</td><td>ZFP36  </td><td>Trm_CD8</td></tr>
	<tr><th scope=row>CCL4L2</th><td>4.095107e-113</td><td>1.8297831</td><td>0.676</td><td>0.447</td><td>8.104217e-109</td><td>CCL4L2 </td><td>Trm_CD8</td></tr>
	<tr><th scope=row>RBM38</th><td> 2.756488e-83</td><td>1.0418639</td><td>0.517</td><td>0.311</td><td> 5.455089e-79</td><td>RBM38  </td><td>Trm_CD8</td></tr>
	<tr><th scope=row>ZFP36L2</th><td> 4.115279e-80</td><td>0.5919972</td><td>0.926</td><td>0.827</td><td> 8.144138e-76</td><td>ZFP36L2</td><td>Trm_CD8</td></tr>
</tbody>
</table>




    
    Cytotox_CD8   Naive_CD8     Tem_CD8     Tex_CD8     Trm_CD8 
            100           5          34         346         143 



```R
jjVolcano(diffData = combined_results,
          tile.col = corrplot::COL2('PuOr', 15)[4:12],
          size  = 4,
          fontface = 'italic',
          base_size = 16,
          legend.position = c(0.9, 0.9),
          cluster.order = rev(unique(combined_results$cluster)))
```

    [1m[22mScale for [32my[39m is already present.
    Adding another scale for [32my[39m, which will replace the existing scale.


    
![deg_12_1.png](https://cdn.jsdelivr.net/gh/capablezzm/capablezzm.github.io@main/images/2025/3/1742900710175.png)
    




# 2.å¯Œé›†åˆ†æ





   

```R
rm(list = ls())
setwd("/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/")

##ç¦æ­¢è½¬åŒ–ä¸ºå› å­
options(stringsAsFactors = FALSE)

## è®¾ç½®ä¿å­˜çš„ç›®å½•
## æ•°æ®ç›®å½•
data_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/data"
if (!dir.exists(data_dir)) {
  dir.create(data_dir, recursive = TRUE)
}
## å›¾ç‰‡ç›®å½•
img_dir <- "/mnt/DEV_8T/zhaozm/seuratå…¨æµç¨‹/å·®å¼‚å¯Œé›†/img"

if (!dir.exists(img_dir)) {
  dir.create(img_dir, recursive = TRUE)
}
```


```R
## åŠ è½½RåŒ…
library(readr)
library(msigdbr) 
library(gplots)
library(ggplot2)
library(clusterProfiler)
library(org.Hs.eg.db)
library(Seurat)
library(singleseqgset)
library(scRNAtoolVis)
library(dplyr)
```

    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜gplotsâ€™
    
    
    The following object is masked from â€˜package:statsâ€™:
    
        lowess
    
    
    
    
    clusterProfiler v4.14.4 Learn more at https://yulab-smu.top/contribution-knowledge-mining/
    
    Please cite:
    
    Guangchuang Yu, Li-Gen Wang, Yanyan Han and Qing-Yu He.
    clusterProfiler: an R package for comparing biological themes among
    gene clusters. OMICS: A Journal of Integrative Biology. 2012,
    16(5):284-287
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜clusterProfilerâ€™
    
    
    The following object is masked from â€˜package:statsâ€™:
    
        filter
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šAnnotationDbi
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šstats4
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šBiocGenerics
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜BiocGenericsâ€™
    
    
    The following objects are masked from â€˜package:statsâ€™:
    
        IQR, mad, sd, var, xtabs
    
    
    The following objects are masked from â€˜package:baseâ€™:
    
        anyDuplicated, aperm, append, as.data.frame, basename, cbind,
        colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
        get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,
        match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,
        Position, rank, rbind, Reduce, rownames, sapply, saveRDS, setdiff,
        table, tapply, union, unique, unsplit, which.max, which.min
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šBiobase
    
    Welcome to Bioconductor
    
        Vignettes contain introductory material; view with
        'browseVignettes()'. To cite Bioconductor, see
        'citation("Biobase")', and for packages 'citation("pkgname")'.
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šIRanges
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šS4Vectors
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜S4Vectorsâ€™
    
    
    The following object is masked from â€˜package:clusterProfilerâ€™:
    
        rename
    
    
    The following object is masked from â€˜package:gplotsâ€™:
    
        space
    
    
    The following object is masked from â€˜package:utilsâ€™:
    
        findMatches
    
    
    The following objects are masked from â€˜package:baseâ€™:
    
        expand.grid, I, unname
    
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜IRangesâ€™
    
    
    The following object is masked from â€˜package:clusterProfilerâ€™:
    
        slice
    
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜AnnotationDbiâ€™
    
    
    The following object is masked from â€˜package:clusterProfilerâ€™:
    
        select
    
    
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šSeuratObject
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šsp
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜spâ€™
    
    
    The following object is masked from â€˜package:IRangesâ€™:
    
        %over%
    
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜SeuratObjectâ€™
    
    
    The following object is masked from â€˜package:IRangesâ€™:
    
        intersect
    
    
    The following object is masked from â€˜package:S4Vectorsâ€™:
    
        intersect
    
    
    The following object is masked from â€˜package:BiocGenericsâ€™:
    
        intersect
    
    
    The following objects are masked from â€˜package:baseâ€™:
    
        intersect, t
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼šMatrix
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜Matrixâ€™
    
    
    The following object is masked from â€˜package:S4Vectorsâ€™:
    
        expand
    
    
    è½½å…¥éœ€è¦çš„ç¨‹åºåŒ…ï¼štidyverse
    




```R
## å¯Œé›†åˆ†æéœ€è¦æŒ‚ä¸Šä»£ç†
Sys.setenv("http_proxy"="http://10.16.46.126:7890")
Sys.setenv("https_proxy"="http://10.16.46.126:7890") 
```


```R
## è¯»å–å·®å¼‚åˆ†æä¹‹åçš„ç»“æœ
tex_cd8_degs_fil <- read.csv(file = "./data/tex_cd8_å·®å¼‚åŸºå› .csv")
head(tex_cd8_degs_fil)
```


<table class="dataframe">
<caption>A data.frame: 6 Ã— 7</caption>
<thead>
	<tr><th></th><th scope=col>X</th><th scope=col>p_val</th><th scope=col>avg_log2FC</th><th scope=col>pct.1</th><th scope=col>pct.2</th><th scope=col>p_val_adj</th><th scope=col>gene</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>GNLY  </td><td>3.132400e-85</td><td> 3.961162</td><td>0.543</td><td>0.147</td><td>6.199019e-81</td><td>GNLY  </td></tr>
	<tr><th scope=row>2</th><td>DUSP2 </td><td>8.528781e-80</td><td>-1.330854</td><td>0.772</td><td>0.969</td><td>1.687846e-75</td><td>DUSP2 </td></tr>
	<tr><th scope=row>3</th><td>ENTPD1</td><td>2.926838e-58</td><td> 2.506306</td><td>0.353</td><td>0.069</td><td>5.792213e-54</td><td>ENTPD1</td></tr>
	<tr><th scope=row>4</th><td>KLRD1 </td><td>6.800869e-58</td><td> 2.146381</td><td>0.476</td><td>0.139</td><td>1.345892e-53</td><td>KLRD1 </td></tr>
	<tr><th scope=row>5</th><td>CALM1 </td><td>5.550144e-57</td><td>-0.838229</td><td>0.868</td><td>0.975</td><td>1.098373e-52</td><td>CALM1 </td></tr>
	<tr><th scope=row>6</th><td>GAPDH </td><td>7.037207e-56</td><td> 1.164210</td><td>0.969</td><td>0.978</td><td>1.392663e-51</td><td>GAPDH </td></tr>
</tbody>
</table>




```R
ids_tex <- bitr(tex_cd8_degs_fil$gene, 'SYMBOL', 'ENTREZID', OrgDb = org.Hs.eg.db)
head(ids_tex)

```

    'select()' returned 1:1 mapping between keys and columns
    
    Warning message in bitr(tex_cd8_degs_fil$gene, "SYMBOL", "ENTREZID", OrgDb = org.Hs.eg.db):
    â€œ2.64% of input gene IDs are fail to map...â€



<table class="dataframe">
<caption>A data.frame: 6 Ã— 2</caption>
<thead>
	<tr><th></th><th scope=col>SYMBOL</th><th scope=col>ENTREZID</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>GNLY  </td><td>10578</td></tr>
	<tr><th scope=row>2</th><td>DUSP2 </td><td>1844 </td></tr>
	<tr><th scope=row>3</th><td>ENTPD1</td><td>953  </td></tr>
	<tr><th scope=row>4</th><td>KLRD1 </td><td>3824 </td></tr>
	<tr><th scope=row>5</th><td>CALM1 </td><td>801  </td></tr>
	<tr><th scope=row>6</th><td>GAPDH </td><td>2597 </td></tr>
</tbody>
</table>




```R
tex_cd8_degs_fil <- merge(tex_cd8_degs_fil, ids_tex, by.x = 'gene', by.y = 'SYMBOL')
tex_cd8_kegg <- enrichKEGG(gene = tex_cd8_degs_fil$ENTREZID.x, organism = "hsa", pvalueCutoff = 1)
write.csv(as.data.frame(tex_cd8_kegg@result), file = "./data/tex_cd8_kegg_result.csv", row.names = FALSE)
```


```R
dotplot(tex_cd8_kegg, showCategory = 10, title = "KEGG Enrichment for Tex_CD8")
```

    
![function_6_0.png](https://cdn.jsdelivr.net/gh/capablezzm/capablezzm.github.io@main/images/2025/3/1742900752255.png)
  
    



```R
## GSEA
library(clusterProfiler)
library(org.Hs.eg.db)
library(dplyr)
library(clusterProfiler)
library(enrichplot)
library(ggupset)
library(cowplot)
```

    enrichplot v1.26.5 Learn more at https://yulab-smu.top/contribution-knowledge-mining/
    
    Please cite:
    
    Guangchuang Yu, Fei Li, Yide Qin, Xiaochen Bo, Yibo Wu and Shengqi
    Wang. GOSemSim: an R package for measuring semantic similarity among GO
    terms and gene products. Bioinformatics. 2010, 26(7):976-978
    
    
    è½½å…¥ç¨‹åºåŒ…ï¼šâ€˜cowplotâ€™
    
    
    The following object is masked from â€˜package:lubridateâ€™:
    
        stamp
    
    



```R
tex_cd8_degs_fil <- tex_cd8_degs_fil[order(tex_cd8_degs_fil$avg_log2FC, decreasing = TRUE),]
tex_markers_list <- setNames(as.numeric(tex_cd8_degs_fil$avg_log2FC), tex_cd8_degs_fil$ENTREZID.x)
tex_cd8_gsea_go <- gseGO(geneList = tex_markers_list, OrgDb = org.Hs.eg.db, ont = "ALL", pvalueCutoff = 0.05)
tex_cd8_gsea_go_arrange <- arrange(as.data.frame(tex_cd8_gsea_go@result), desc(abs(NES)))
write.csv(tex_cd8_gsea_go_arrange, file = "./data/tex_cd8_gsea_go_results.csv", row.names = FALSE)
```

    using 'fgsea' for GSEA analysis, please cite Korotkevich et al (2019).
    
    
    preparing geneSet collections...
    
    GSEA analysis...
    
    Warning message in fgseaMultilevel(pathways = pathways, stats = stats, minSize = minSize, :
    â€œThere were 2 pathways for which P-values were not calculated properly due to unbalanced (positive and negative) gene-level statistic values. For such pathways pval, padj, NES, log2err are set to NA. You can try to increase the value of the argument nPermSimple (for example set it nPermSimple = 10000)â€
    Warning message in fgseaMultilevel(pathways = pathways, stats = stats, minSize = minSize, :
    â€œFor some of the pathways the P-values were likely overestimated. For such pathways log2err is set to NA.â€
    leading edge analysis...
    
    done...
    



```R
# å®šä¹‰é…è‰²
color <- c("#f7ca64", "#43a5bf", "#86c697", "#a670d6", "#ef998a")
```


```R
# ç»˜åˆ¶ tex_cd8 çš„ GSEA-GO å›¾
## ä¸Šè°ƒ
# æå–ä¸Šè°ƒé€šè·¯
upregulated_pathways <- tex_cd8_gsea_go@result %>%
  filter(NES > 0) %>%                       # ç­›é€‰ä¸Šè°ƒé€šè·¯
  arrange(desc(NES)) %>%                    # æŒ‰NESé™åºæ’åˆ—
  slice(1:5)                                # é€‰æ‹©å‰5æ¡é€šè·¯
# ç»˜åˆ¶å‰5æ¡ä¸Šè°ƒé€šè·¯çš„GSEAæ›²çº¿
gsekp1_tex <- gseaplot2(
  tex_cd8_gsea_go,                          # GSEAç»“æœå¯¹è±¡
  geneSetID = upregulated_pathways$ID,      # ä¸Šè°ƒé€šè·¯çš„IDå‘é‡
  pvalue_table = F,                      # æ˜¯å¦æ˜¾ç¤ºpå€¼è¡¨
  base_size = 12,                           # å­—ä½“å¤§å°
  color = color # å¯é€‰é¢œè‰²
)
upregulated_pathways$Description
# æ˜¾ç¤ºå›¾å½¢
gsekp1_tex
```


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'negative regulation of immune system process'</li><li>'regulation of response to external stimulus'</li><li>'negative regulation of cell population proliferation'</li><li>'regulation of leukocyte mediated cytotoxicity'</li><li>'regulation of cell killing'</li></ol>




    
 
![function_10_1.png](https://cdn.jsdelivr.net/gh/capablezzm/capablezzm.github.io@main/images/2025/3/1742900755524.png)
    

